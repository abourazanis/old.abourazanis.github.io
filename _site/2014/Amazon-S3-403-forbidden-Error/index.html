<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>
    <meta name="author" content="" />
    <meta name="description" content="">

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>
      
        Amazon S3 403 forbidden Error - Anastasios Bourazanis
      
    </title>
    <link rel="canonical" href="/2014/Amazon-S3-403-forbidden-Error/" />

    <!-- RSS -->
    <link rel="alternate" type="application/atom+xml" title=" â€” Feed" href="//atom.xml">

    <!-- CSS -->
    <link href='/assets/global-c95bf6a19ea040de4fbdbca9d04bec3b.css' rel='stylesheet' type='text/css' />


    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Lato">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

</head>


  <body>

    <header role="banner" class="sidebar">
  <div class="container sidebar">
    <figure class="profilepic">
      
        <script src="/public/javascripts/md5.js"></script>
        <script type="text/javascript">
          $(function(){
            $('.profilepic').append("<a href='/'><img src='http://www.gravatar.com/avatar/" + MD5("a.bourazanis@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' /></a>");
          });
        </script>
      
    </figure>
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Anastasios Bourazanis
        </a>
      </h1>
      <h2 class="lead"></h2>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive/">Archive</a>
          
        
      
        
      
        
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
    </nav>
    <nav class="sidebar-social">
      
      
        <a class="facebook" href="http://www.facebook.com/anastasios.bourazanis" title="Facebook">Facebook</a>
      
      
        <a class="google" href="https://plus.google.com/+AnastasiosBourazanis" rel="author" title="Google+">Google+</a>
      
      
        <a class="twitter" href="http://twitter.com/ABourazanis" title="Twitter">Twitter</a>
      
      
        <a class="github" href="https://github.com/tas0s" title="GitHub">GitHub</a>
      
      
      
      
        <a class="linkedin" href="http://www.linkedin.com/in/abourazanis" title="LinkedIn">LinkedIn</a>
      
      
      
      
      
      
      
        
        
        <a class="rss" href="/atom.xml" title="RSS">RSS</a>
      
    </nav>

  </div>
</header>


    <div class="content container">
      <article class="post">
<header>
    <div class="meta">
      <div class="date">29 Sep 2014</div>
      

    
        
        
             <div class="categories">
                <a class='category' href='/categories/aws/'>aws</a>, <a class='category' href='/categories/django/'>django</a>, <a class='category' href='/categories/web-development/'>web development</a>
            </div>
        
    


       <div class="comments"><a href="/2014/Amazon-S3-403-forbidden-Error/#disqus_thread">View Comments</a></div> 
    </div>
    <h1 class="post-title">Amazon S3 403 forbidden Error</h1>
  </header>
  <div><p>On the startup I work we use many Amazon Web Services for our website infrastructure.
One of them is Amazon&#39;s Cloud Storage or <a href="http://aws.amazon.com/s3/">Amazon S3</a> as they have named it.
With S3 Amazon provides storage access through standarized web service interfaces (e.g REST).<br/>
So that&#39;s about S3, more information you can find on their <a href="http://aws.amazon.com/s3/">site</a>.</p>

<p>To use Amazon S3 service with our django setup we have used the excellent
<a href="http://django-storages.readthedocs.org/en/latest/">django-storages</a>.</p>

<p>After a couple of months with no issues at all, I tried to upload a file to S3 via the admin interface of django when the following
error occured:</p>

<!--more-->

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">File</span> <span class="s">&quot;../lib/python2.7/site-packages/boto/s3/bucket.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">169</span><span class="p">,</span> <span class="ow">in</span> <span class="n">get_key</span>
    <span class="n">key</span><span class="p">,</span> <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_key_internal</span><span class="p">(</span><span class="n">key_name</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">query_args_l</span><span class="p">)</span>
  <span class="n">File</span> <span class="s">&quot;../lib/python2.7/site-packages/boto/s3/bucket.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">211</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_get_key_internal</span>
    <span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
<span class="n">S3ResponseError</span><span class="p">:</span> <span class="n">S3ResponseError</span><span class="p">:</span> <span class="mi">403</span> <span class="n">Forbidden</span></code></pre></div>

<p>First, I tried to check if something has changed or was wrong with our AWS credentials.
I checked if we have read/write access to the corresponding S3 bucket:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">boto</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s3</span> <span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">connect_s3</span><span class="p">(</span><span class="s">&#39;&lt;access_key&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;secret_key&gt;&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">bucket</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">&#39;s3_bucket_name&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">key</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">new_key</span><span class="p">(</span><span class="s">&#39;testkey&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">key</span><span class="o">.</span><span class="n">set_contents_from_string</span><span class="p">(</span><span class="s">&#39;This is a read/write test&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">key</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span></code></pre></div>

<p>All went as it should. So our credentials are correct.</p>

<p>After a couple of hours of
trial and error <img class="right" src="/public/images/writing_process.gif">
I found the cause:
Our server&#39;s misconfigured TIME. It was wrong, and AWS respond with a <i>403 FORBIDDEN</i>.</p>

<p>In order to update the time to the correct value I just ran:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo ntpdate 0.pool.ntp.org</code></pre></div>

<p>After that I have checked that ntp is set to auto update by set /etc/cron.daily/ntpdate to be executable:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo chmod <span class="m">755</span> /etc/cron.daily/ntpdate</code></pre></div>

<p>So that was all!
<img class="center" src="/public/images/code-35.gif"></p>
</div>
</article>

    <section id="comment">
      <h1 class="title">Comments</h1>
      <div id="disqus_thread">
        <script type="text/javascript">
            var disqus_shortname = 'abourazanis';

            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </section>




<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2014/How-I-started-my-own-Jekyll-blog/">
            How I started my own Jekyll blog
            <small>12 Sep 2014</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>
   
     <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'abourazanis'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
        </script>


  
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-36113001-3', 'auto');
      ga('send', 'pageview');

    </script>



  </body>
</html>
